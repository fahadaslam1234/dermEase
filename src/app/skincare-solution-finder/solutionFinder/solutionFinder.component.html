<div class="container">
  <div class="intro" *ngIf="isIntro">
    <button class="intro-button primary-button" (click)="startStepper()">LET'S GO!</button>
  </div>
  <div *ngIf="!isIntro && showStepper">
    <mat-horizontal-stepper [linear]="true" #stepper>
      <mat-step [stepControl]="firstFormGroup" label="Step 1">
        <form [formGroup]="firstFormGroup">
          <ng-template matStepLabel>Step 1</ng-template>
          <h2>Let's start with your facial skincare.</h2>
          <p>Please select your one top concern.</p>
          <div class="cards">
            <mat-card *ngFor="let concern of concerns"
                      (click)="selectConcern(concern)"
                      [class.selected]="selectedConcerns === concern">
              <mat-card-content>
                <p>{{concern}}</p>
              </mat-card-content>
            </mat-card>
          </div>
          <div>
            <button class="primary-button" matStepperNext [disabled]="!selectedConcerns">Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="secondFormGroup" label="Step 2">
        <form [formGroup]="secondFormGroup">
          <ng-template matStepLabel>Step 2</ng-template>
          <h2>How does the skin on your face typically feel?</h2>
          <p>Select one</p>
          <div class="cards">
            <mat-card *ngFor="let skinFeel of skinFeels"
                      (click)="selectSkinFeel(skinFeel)"
                      [class.selected]="selectedSkinFeel === skinFeel">
              <mat-card-content>
                <p>{{skinFeel}}</p>
              </mat-card-content>
            </mat-card>
          </div>
          <div class="button-layout">
            <button class="primary-button" matStepperPrevious>Back</button>
            <button class="primary-button" matStepperNext [disabled]="!selectedSkinFeel">Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="fifthFormGroup" label="Step 3">
        <form [formGroup]="fifthFormGroup">
          <ng-template matStepLabel>Step 3</ng-template>
          <h2>Now let's talk about your body, what type of ingredients do you prefer?</h2>
          <p>Select one</p>
          <div class="cards">
            <mat-card *ngFor="let bodyConcern of ingredientPreferences"
                      (click)="selectBodyConcern(bodyConcern)"
                      [class.selected]="selectedBodyConcern === bodyConcern">
              <mat-card-content>
                <p>{{bodyConcern}}</p>
              </mat-card-content>
            </mat-card>
          </div>
          <div class="button-layout">
            <button matStepperPrevious class="primary-button">Back</button>
            <button (click)="showResults()" [disabled]="!selectedBodyConcern" class="primary-button">Show Results</button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
  <div *ngIf="recommendation?.data?.matchingProducts?.length > 0" class="recommendation product-grid">
    <h2>Hi!</h2>
    <span>Here is your Recommended Product.</span> <br>
    <span> Note: Check with your dermatologist for further diagnoses or treatment.</span>
    <div class="product-card">
      <img [src]="recommendation.data.matchingProducts[0]?.product_image" alt="{{ recommendation.data.matchingProducts[0]?.product_name }}">
      <h3>{{ recommendation.data.matchingProducts[0]?.product_name }}</h3>
      <!-- <p>{{ recommendation.data.matchingProducts[0]?.product_description }}</p> -->
      <div class="price">
        <span *ngIf="recommendation.data.matchingProducts[0]?.old_price" class="old-price">Rs {{ recommendation.data.matchingProducts[0]?.old_price }}</span>
        <span>Rs &nbsp; {{ recommendation.data.matchingProducts[0]?.price }}</span>
      </div>
      <div class="actions">
        <span (click)="addToCart(recommendation.data.matchingProducts[0])">Add to Cart</span>
        <span (click)="quickView(recommendation.data.matchingProducts[0])">Quickview</span>
      </div>
    </div>
  </div>


  <div *ngIf="recommendation?.data?.matchingProducts?.length === 0" class="no-products">
    <h2>No Products Found</h2>
    <p>{{ recommendation?.data?.message }}</p>
  </div>
  <div class="stepper-instructions">
    <h3>Looking for a dermatologist-recommended skincare routine?</h3>
    <h4>DermEase is here to help!</h4>
    <p>This Solution Finder is provided for informational purposes only and is not intended to replace professional medical advice, diagnoses, or
      treatments. Please consult your dermatologist or doctor if you have any skin issues or concerns.</p>
    <p>By taking this quiz you agree to Our Terms of Use and acknowledge you read Our Privacy Policy.</p>
  </div>
</div>

<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "rgb(202, 56, 185)" type = "ball-fussion" [fullScreen] = "true"></ngx-spinner>
