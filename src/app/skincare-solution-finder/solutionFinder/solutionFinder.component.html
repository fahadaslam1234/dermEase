<div class="container">
  <div class="intro" *ngIf="isIntro">
    <button class="intro-button primary-button" (click)="startStepper()">LET'S GO!</button>
  </div>
  <div *ngIf="!isIntro && showStepper">
    <mat-horizontal-stepper [linear]="true" #stepper>
      <mat-step [stepControl]="firstFormGroup" label="Step 1">
        <form [formGroup]="firstFormGroup">
          <ng-template matStepLabel>Step 1</ng-template>
          <h2>Let's start with your facial skincare.</h2>
          <p>Please select your one top concern.</p>
          <div class="cards">
            <mat-card *ngFor="let concern of concerns"
                      (click)="selectConcern(concern)"
                      [class.selected]="selectedConcerns === concern">
              <mat-card-content>
                <p>{{concern}}</p>
              </mat-card-content>
            </mat-card>
          </div>
          <div>
            <button class="primary-button" matStepperNext [disabled]="!selectedConcerns">Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="secondFormGroup" label="Step 2">
        <form [formGroup]="secondFormGroup">
          <ng-template matStepLabel>Step 2</ng-template>
          <h2>How does the skin on your face typically feel?</h2>
          <p>Select one</p>
          <div class="cards">
            <mat-card *ngFor="let skinFeel of skinFeels"
                      (click)="selectSkinFeel(skinFeel)"
                      [class.selected]="selectedSkinFeel === skinFeel">
              <mat-card-content>
                <p>{{skinFeel}}</p>
              </mat-card-content>
            </mat-card>
          </div>
          <div class="button-layout">
            <button class="primary-button" matStepperPrevious>Back</button>
            <button class="primary-button" matStepperNext [disabled]="!selectedSkinFeel">Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="fifthFormGroup" label="Step 3">
        <form [formGroup]="fifthFormGroup">
          <ng-template matStepLabel>Step 3</ng-template>
          <h2>Now let's talk about your body, what type of ingredients do you prefer?</h2>
          <p>Select one</p>
          <div class="cards">
            <mat-card *ngFor="let bodyConcern of ingredientPreferences"
                      (click)="selectBodyConcern(bodyConcern)"
                      [class.selected]="selectedBodyConcern === bodyConcern">
              <mat-card-content>
                <p>{{bodyConcern}}</p>
              </mat-card-content>
            </mat-card>
          </div>
          <div class="button-layout">
            <button matStepperPrevious class="primary-button">Back</button>
            <button (click)="showResults()" [disabled]="!selectedBodyConcern" class="primary-button">Show Results</button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
  <div *ngIf="recommendation?.data?.matchingProducts?.length > 0" class="recommendation product-grid">
    <h2>Hi!</h2>
    <span>Here are your Recommended Products.</span> <br>
    <span>Note: Check with your dermatologist for further diagnoses or treatment.</span>

    <!-- Loop through all matching products and display them in a grid -->
    <div class="product-list">
      <div *ngFor="let product of recommendation.data.matchingProducts" class="product-card">
        <img [src]="product?.product_image" alt="{{ product?.product_name }}">
        <h3>{{ product?.product_name }}</h3>
        <div class="price">
          <span *ngIf="product?.old_price" class="old-price">Rs {{ product?.old_price }}</span>
          <span>Rs &nbsp; {{ product?.price }}</span>
        </div>
        <div class="actions">
          <span (click)="addToCart(product)">Add to Cart</span>
          <span (click)="quickView(product)" class="quickView">Quickview</span>
        </div>
      </div>
    </div>
  </div>

  <!-- If no matching products are found -->
  <div *ngIf="recommendation?.data?.matchingProducts?.length === 0" class="no-recommendation">
    <h2>Sorry!</h2>
    <span>We couldn't find any matching products in our store.</span>
    <span>But you can check the following external sources for availability:</span>

    <!-- Display external links for recommendations -->
    <ul *ngIf="recommendation?.data?.externalLinks?.length > 0">
      <li *ngFor="let external of recommendation.data.externalLinks">
        <h3>{{ external.name }}</h3>
        <ul>
          <li *ngFor="let link of external.links">
            <a [href]="link.url" target="_blank">{{ link.name }}</a>
          </li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="stepper-instructions">
    <h3>Looking for a dermatologist-recommended skincare routine?</h3>
    <h4>DermEase is here to help!</h4>
    <p>This Solution Finder is provided for informational purposes only and is not intended to replace professional medical advice, diagnoses, or
      treatments. Please consult your dermatologist or doctor if you have any skin issues or concerns.</p>
    <p>By taking this quiz you agree to Our Terms of Use and acknowledge you read Our Privacy Policy.</p>
  </div>
</div>

<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "rgb(202, 56, 185)" type = "ball-fussion" [fullScreen] = "true"></ngx-spinner>
